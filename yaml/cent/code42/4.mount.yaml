---
  - name: Install Node and pm2
    hosts: cents
    gather_facts: no
    vars:
      mntdir: /mnt/nas/smms_output
      nasdir: //10.0.0.148/smms_output
      nasuser: Sln_Server_Account
      naspass: Tmxmfltm\!234
  
    tasks:
      - name: upgrade all packages
        yum: name='*' state=latest
  
      - name: install pre-mount tool for cifs
        yum: name=cifs-utils state=present

      - name: Make Directories
        shell: mkdir {{mntdir}} -p

      - name: Mount drive
        shell: mount -t cifs //10.0.0.148/smms_output /mnt/nas/smms_output -o user={{naspass}},pass={{nasuser}},rw,vers=1.0 || echo "mounted"

      - name: make mount script
        shell: |
          echo "#!/bin/sh
          # chkconfig: 234 90 90
          # description: mount nas drive
          mount -t cifs {{nasdir}} {{mntdir}} -o user={{naspass}},pass={{nasuser}},rw,vers=1.0 || echo "mounted"
          " > /etc/init.d/mount

      - name: make it startup
        shell: |
          chmod 755 /etc/init.d/mount
          chwon root.root /etc/init.d/mount
          chkconfig --add mount
